#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');
const realCurrentPath = path.join(__dirname, '/../dist/index.js');

function execCommand(command) {
  exec(command, (error, stdout, stderr) => {
    if (error) {
      console.log(error);
      return;
    }
    if (stdout) {
      console.log(stdout);
      return;
    }
    console.log(stderr);
    console.log('error to exec node ./dist/index.js');
  });
}

const conditional = fs.existsSync(realCurrentPath);
console.info("[+] - the path of package 'clifrontend':", realCurrentPath);
if (conditional) {
  console.info("[+] - exist the path dist/index.js from package 'clifrontend'");
  const newPath = path.join(__dirname, '/../dist');
  require(newPath).run();
  return;
}

console.log("hasn't folder dist");
const command1 = path.join(__dirname, '/../src/');
const command2 = path.join(__dirname, '/../dist/index.js');
execCommand(`npx tsc ${command1} && node ${command2}`);
